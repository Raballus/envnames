---
output:
  html_document:
    theme: null
    highlight: null
---

```{r settings, echo=FALSE}
library(knitr)
options(Encoding="UTF-8")
options(warn=-1)
opts_chunk$set(collapse=TRUE)
# Compile to PDF by running in CMD:
# "C:\Program Files\R\RStudio\bin\pandoc\pandoc" -s envnames-MilanoRBlog-Introduction.html -o envnames-MilanoRBlog-Introduction.pdf
```

# Want to know an environment's name? Use package `envnames`

## Introduction

If you are used to working with your own environments --for instance when developing a package-- you may have been frustated by the output of running a code similar to the following:  

```{r EnvironmenName}
myenv <- new.env()
environmentName(myenv)
```

The frustration may have come when you see the empty string in the output from the `environmentName()` function, instead of `myenv`.

Gladly, the `environment_name()` function in the recently released [envnames](https://cran.r-project.org/web/packages/envnames) package comes to our rescue in these situations, as explained in the upcoming sections.

## The `environment_name()` function does give us the name of the environment
We can use the [environment_name()](https://rdrr.io/cran/envnames/man/environment_name.html) function of the package to retrieve the name of the user-defined environment we created above:

```{r environment_name}
library(envnames)
environment_name(myenv)
```

or

```{r environment_name_on_address}
library(envnames)
environment_name(address(myenv))
```

where we have used the package's [address()](https://rdrr.io/cran/envnames/man/address.html) function to show that the environment name can also be retrieved from the environment's **memory address**, which is where this function becomes truly useful.

In fact, this may come really handy when debugging a program and navigating through environments. In those situations it is not rare to come across a memory address that represents an environment and we may want to know which environment it represents. To this end, we can simply copy & paste the memory address shown in the R console (e.g. `"<environment: 0x00000000147499b0>"`) and run `environment_name("<environment: 0x00000000147499b0>")` to get the name of the environment represented by the memory address.

## How it works
The `envnames` package is capable of accessing the name of *any* environment --be it a system environment, a package, a namespace, a user-defined environment, or even a function execution environment-- by way of a lookup table that maps environment names to their memory addresses. The lookup table is created every time one of the 11 visible functions defined in the package is run, thus updating the map to the latest changes in the workspace.

## Capabilities worth mentioning

### Looking for an object in nested environments
The following picture shows an environment space that highlights the connection between package and system environments (child `->` parent relationships) and in particular the possibility of defining nested environments, which are the topic of this section.  
![](E:\Daniel\Projects\R\packages\envnames\docs\EnvironmentSpaceExample.png){width=8in}

The package includes the [obj_find()](https://rdrr.io/cran/envnames/man/obj_find.html) function that is able to look for objects in *nested* environments. The following example, where environments and objects are defined to mimic the situation shown in the above figure, illustrates the search for objects `x` and `y` in the whole workspace.

First we define objects `x` and `y`:
```{r NestedEnvironments}
outer_env <- new.env()
outer_env$nested_env <- new.env(parent=emptyenv())
x <- 0
with(outer_env, x <- 3)
with(outer_env,
	{
		nested_env$x <- 5.7;
		nested_env$y <- "phrase"
	})
```

Now we look for the objects using `obj_find(x)` and `obj_find(y)`:
```{r LookForObjects}
cat("\nObject 'x' is found in the following environments:\n", paste(obj_find(x), collapse="\n"), "\n", sep="")
cat("\nObject 'y' is found in the following environments:\n", paste(obj_find(y), collapse="\n"), "\n", sep="")
```

We see that object `x` is found in all three environments where it is defined, including *nested* environments, showing the path to reach the object. Note also that the global environment is retrieved as `R_GlobalEnv`.

### Looking for an object in a function's execution environment
If we are working inside a function, we could also look for objects defined in the function calling chain by specifying `include_functions=TRUE`, as shown in the following example:
```{r FunctionEnvironments}
h <- function() {
 	x <- 10.37
 	cat("Object 'x' is found in the following environments:\n", paste(obj_find(x, include_functions=TRUE), collapse="\n"), "\n", sep="")
}
env1 <- new.env()
with(env1, 
	g <- function() {
		x <- 2
		h()
	}
)
env1$g()
```

Object `x` is found in 11 function and regular environments. For now, regular environments cannot be distinguished from function environments, but this will be improved in a future release where the plan is to add the `()` symbol at the end of function environment names, as in `env1$g()`.

\newpage
## Conclusion
If you install the [envnames](https://cran.r-project.org/web/packages/envnames) package you would be able to:  
- **look for objects** in the workspace, including *nested environments*, and *function execution environments*.  
- **see the name of the environments** where those objects reside, be it a system environment, a package, a namespace, a user-defined environment or, when working inside a function, the name of the function whose execution environment is hosting the object.  
- **know the name of an environment behind a memory address** (specially useful in debug contexts)  

To learn more about further capabilities provided by the package, I invite you to take a look at the **[vignette](https://cran.r-project.org/web/packages/envnames/vignettes/envnames.pdf)**.

Finally, if you decide to install it and use it, I would be very happy to learn about your use cases, so just drop me a comment below.

&nbsp;
&nbsp;

#### References
Motivation for writing this package: https://stat.ethz.ch/pipermail/r-help/2010-July/245646.html (question by Gabor Grothendieck at a forum on R in 2010)

#### Acknowledgements
I would like to acknowledge Andrea SpanÃ²'s contribution in inspiring the development of this package during the [R for Developers course he gave at Quantide](http://www.quantide.com/ramarro-r-for-developers/).

#### Session Info
This article was generated with [envnames-v0.4.0](https://cran.r-project.org/web/packages/envnames) on the following platform and R version:
```{r SystemInfo, echo=FALSE}
data.frame(SystemInfo=Sys.info()[c("sysname", "release", "version", "machine")])
version
```
